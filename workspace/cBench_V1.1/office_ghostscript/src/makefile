FILES= zfcmap.c zht2.c zmath.c iparam.c gspath1.c zchar42.c gxclread.c scfd.c sfxstdio.c gschar.c gsutil.c zimage2.c gxclimag.c gxhint1.c zchar.c gsargs.c gsbitops.c gsfcmap.c szlibd.c zfilter2.c gximage.c jcomapi.c gdevpsdf.c gdevvec.c gxcmap.c seexec.c zvmem2.c jdpostct.c gdevm2.c zfzlib.c zarith.c gschar0.c zpath.c gxpath2.c gdevm16.c gdevpipe.c gdevpdf.c gxctable.c stream.c gs.c szlibc.c smtf.c imainarg.c jdinput.c gdevm4.c zstring.c gspath.c gsflip.c icontext.c gxccman.c zcsindex.c gsfont.c jdhuff.c gsrop.c zfdecode.c jcapistd.c jdcolor.c sdctd.c zcie.c zpacked.c spngp.c jcparam.c zrelbit.c gxpdash.c gdevpdfm.c ilocate.c spcxd.c jdapimin.c zfont1.c gxcht.c gscoord.c zfont.c gsmatrix.c sjpegerr.c gp_nofb.c gdevprn.c zfont2.c ialloc.c igcref.c scfetab.c ireclaim.c jidctint.c gximage4.c slzwd.c gdevm32.c gsmisc.c gxpcopy.c gscdefs.c jdmainct.c gsdps1.c iinit.c gxcpath.c gdevddrw.c gstype42.c zcontrol.c iccinit0.c sbwbs.c iutil2.c gdevbbox.c igcstr.c gximage3.c zmisc.c jdapistd.c zimage.c slzwce.c jccolor.c gdevps.c gspaint.c istack.c sbhc.c gxclrect.c zdict.c zfile.c slzwc.c zdevcal.c zusparam.c sbcp.c gdevm24.c gscolor.c sjpegc.c gdevmrop.c zfont0.c gximage5.c gxclzlib.c gsimage.c jfdctint.c gdevmem.c gscie.c jdmarker.c ztype.c ziodev2.c gspcolor.c sdcte.c sdctc.c zcid.c interp.c ziodev.c zstack.c iname.c gxdither.c jdsample.c zmisc1.c sjpege.c gsiodev.c gxhint3.c zfilterx.c jutils.c gdevpx.c gsfont0.c gxdcconv.c gdevm8.c igc.c gxclpage.c gxclist.c jcmainct.c gscolor1.c jcdctmgr.c shcgen.c idict.c gxpcmap.c gxbcache.c zdevice2.c gdevpdfp.c gxpaint.c scantab.c sstring.c jmemmgr.c zmatrix.c zcharout.c iscan.c zhsb.c shc.c zcssepr.c gxsample.c gsbittab.c gp_unifn.c gsht1.c gsimpath.c gsmemory.c zdps1.c zcolor2.c gsparam.c zht.c gximage0.c jcapimin.c jcmarker.c gxfill.c zupath.c spdiff.c gconfig.c loop-wrap.c zht1.c zpcolor.c idparam.c scfe.c jdmaster.c gdevpstr.c gsroptab.c gdevpdfi.c zchar2.c gscolor2.c zfproc.c jcmaster.c gxclbits.c zfileio.c gp_unix.c gxhint2.c srld.c gxpath.c jcprepct.c gsdevmem.c gshtscr.c zgeneric.c zgstate.c zsysvm.c imain.c gshsb.c iscanbin.c zbseq.c szlibe.c zfbcp.c zfdctc.c jdphuff.c idebug.c gdevdflt.c gxccache.c zpath1.c gscsepr.c gxpflat.c gdevnfwd.c jdcoefct.c gximage2.c iconfig.c gxtype1.c zcrd.c sfilter1.c gxht.c zarray.c gdevmpla.c ibnum.c jddctmgr.c sfilter2.c gxstroke.c zfdctd.c zfont42.c gsdevice.c gxacpath.c gsdparam.c gdevabuf.c sjpegd.c zchar1.c zcolor1.c gxclpath.c jcsample.c ztoken.c gxclfile.c jcinit.c gxclip2.c gsht.c iutil.c gstype1.c gsstate.c siscale.c zmedia2.c zfilter.c gsinit.c gximage1.c gdevpbm.c jchuff.c zfdcte.c gsalloc.c iscannum.c isave.c srle.c zcolor.c gsline.c zfname.c gp_unifs.c gstype2.c zdevice.c zmisc2.c scfdtab.c jccoefct.c gdevm1.c zpaint.c zvmem.c gxdcolor.c gdevpdft.c
OBJs= zfcmap.o zht2.o zmath.o iparam.o gspath1.o zchar42.o gxclread.o scfd.o sfxstdio.o gschar.o gsutil.o zimage2.o gxclimag.o gxhint1.o zchar.o gsargs.o gsbitops.o gsfcmap.o szlibd.o zfilter2.o gximage.o jcomapi.o gdevpsdf.o gdevvec.o gxcmap.o seexec.o zvmem2.o jdpostct.o gdevm2.o zfzlib.o zarith.o gschar0.o zpath.o gxpath2.o gdevm16.o gdevpipe.o gdevpdf.o gxctable.o stream.o gs.o szlibc.o smtf.o imainarg.o jdinput.o gdevm4.o zstring.o gspath.o gsflip.o icontext.o gxccman.o zcsindex.o gsfont.o jdhuff.o gsrop.o zfdecode.o jcapistd.o jdcolor.o sdctd.o zcie.o zpacked.o spngp.o jcparam.o zrelbit.o gxpdash.o gdevpdfm.o ilocate.o spcxd.o jdapimin.o zfont1.o gxcht.o gscoord.o zfont.o gsmatrix.o sjpegerr.o gp_nofb.o gdevprn.o zfont2.o ialloc.o igcref.o scfetab.o ireclaim.o jidctint.o gximage4.o slzwd.o gdevm32.o gsmisc.o gxpcopy.o gscdefs.o jdmainct.o gsdps1.o iinit.o gxcpath.o gdevddrw.o gstype42.o zcontrol.o iccinit0.o sbwbs.o iutil2.o gdevbbox.o igcstr.o gximage3.o zmisc.o jdapistd.o zimage.o slzwce.o jccolor.o gdevps.o gspaint.o istack.o sbhc.o gxclrect.o zdict.o zfile.o slzwc.o zdevcal.o zusparam.o sbcp.o gdevm24.o gscolor.o sjpegc.o gdevmrop.o zfont0.o gximage5.o gxclzlib.o gsimage.o jfdctint.o gdevmem.o gscie.o jdmarker.o ztype.o ziodev2.o gspcolor.o sdcte.o sdctc.o zcid.o interp.o ziodev.o zstack.o iname.o gxdither.o jdsample.o zmisc1.o sjpege.o gsiodev.o gxhint3.o zfilterx.o jutils.o gdevpx.o gsfont0.o gxdcconv.o gdevm8.o igc.o gxclpage.o gxclist.o jcmainct.o gscolor1.o jcdctmgr.o shcgen.o idict.o gxpcmap.o gxbcache.o zdevice2.o gdevpdfp.o gxpaint.o scantab.o sstring.o jmemmgr.o zmatrix.o zcharout.o iscan.o zhsb.o shc.o zcssepr.o gxsample.o gsbittab.o gp_unifn.o gsht1.o gsimpath.o gsmemory.o zdps1.o zcolor2.o gsparam.o zht.o gximage0.o jcapimin.o jcmarker.o gxfill.o zupath.o spdiff.o gconfig.o loop-wrap.o zht1.o zpcolor.o idparam.o scfe.o jdmaster.o gdevpstr.o gsroptab.o gdevpdfi.o zchar2.o gscolor2.o zfproc.o jcmaster.o gxclbits.o zfileio.o gp_unix.o gxhint2.o srld.o gxpath.o jcprepct.o gsdevmem.o gshtscr.o zgeneric.o zgstate.o zsysvm.o imain.o gshsb.o iscanbin.o zbseq.o szlibe.o zfbcp.o zfdctc.o jdphuff.o idebug.o gdevdflt.o gxccache.o zpath1.o gscsepr.o gxpflat.o gdevnfwd.o jdcoefct.o gximage2.o iconfig.o gxtype1.o zcrd.o sfilter1.o gxht.o zarray.o gdevmpla.o ibnum.o jddctmgr.o sfilter2.o gxstroke.o zfdctd.o zfont42.o gsdevice.o gxacpath.o gsdparam.o gdevabuf.o sjpegd.o zchar1.o zcolor1.o gxclpath.o jcsample.o ztoken.o gxclfile.o jcinit.o gxclip2.o gsht.o iutil.o gstype1.o gsstate.o siscale.o zmedia2.o zfilter.o gsinit.o gximage1.o gdevpbm.o jchuff.o zfdcte.o gsalloc.o iscannum.o isave.o srle.o zcolor.o gsline.o zfname.o gp_unifs.o gstype2.o zdevice.o zmisc2.o scfdtab.o jccoefct.o gdevm1.o zpaint.o zvmem.o gxdcolor.o gdevpdft.o
FLAGS=

all: $(FILES)
	@$(RM) IRinfo* *.profraw
	@clang $(FILES) -O0 -emit-llvm -S -o A.ll -w $(FLAGS)
	@opt A.ll -S -o B.ll $(OPTFLAGS)
	@opt B.ll -S -o tmp.ll -O0 -load $(IR_PASS)
	@clang B.ll -O0 $(ULT)/polybench.o -lm $(FLAGS)

hotpath: $(FILES)
	@$(RM) IRinfo* *.profraw
	@clang $(FILES) -O0 -emit-llvm -S -o A.ll -w $(FLAGS)
	@opt A.ll -S -o B.ll $(OPTFLAGS)
	@opt B.ll -S -o C.ll -O0 -profile-generate
	@opt B.ll -S -o tmp.ll -O0 -load $(IR_PASS)
	@clang B.ll -O0 $(ULT)/polybench.o -fprofile-generate -lm -o p.out $(FLAGS)
	@./p.out
	@llvm-profdata show -counts -all-functions default* > hotpath.txt
	@opt C.ll -S -o tmp.ll -O0 -load $(IR_PASS) -hotpath -hotpath-file=hotpath.txt
	@clang B.ll -O0 $(ULT)/polybench.o -lm $(FLAGS)

%.ll: %.c
	@clang $^ -O0 -emit-llvm -S -o $@ -w $(FLAGS)

%.ll1: %.ll
	@opt $^ -S -o $@ $(OPTFLAGS)
	@opt $@ -S -o tmp.ll -O0 -load $(IR_PASS)   #first analysis

bin_p: *.ll1
	@clang $^ -O0 -fprofile-generate -lm -o p.out
	@./p.out
	@llvm-profdata show -counts -all-functions default* > hotpath.txt

%.ll2: %.ll p.out
	@opt $^ -S -o $@ $(OPTFLAGS) -O0 -profile-generate
	@opt $@ -S -o tmp.ll -O0 -load $(IR_PASS) -hotpath -hotpath-file=hotpath.txt

bin_o: *.ll2
	@clang $^ -O0 -fprofile-generate -lm -o o.out
